# -*- coding: utf-8 -*-
"""
Конфигурационный файл для программы сравнения периодов Excel файлов
Содержит все настройки и параметры для работы программы
"""

import os
from pathlib import Path

# Базовые пути (кроссплатформенные)
BASE_DIR = Path(__file__).parent.absolute()
IN_XLSX_DIR = BASE_DIR / "IN_XLSX"
OUT_XLSX_DIR = BASE_DIR / "OUT_XLSX"
LOGS_DIR = BASE_DIR / "LOGS"

# Создание каталогов если они не существуют
IN_XLSX_DIR.mkdir(exist_ok=True)
OUT_XLSX_DIR.mkdir(exist_ok=True)
LOGS_DIR.mkdir(exist_ok=True)

# Настройки логирования
from datetime import datetime
log_timestamp = datetime.now().strftime("%Y%m%d_%H%M")
LOG_CONFIG = {
    'level': 'DEBUG',  # INFO или DEBUG
    'file': str(LOGS_DIR / f'comparison_{log_timestamp}.log'),
    'format': '%(asctime)s - %(levelname)s - %(message)s'
}

# Сообщения для логирования удалены - теперь используются прямые тексты в коде

# Параметры анализа
ANALYSIS_CONFIG = {
    
    # Режим расчета прироста
    'growth_calculation_mode': 'report_date',  # 'report_date' или 'deal_date'
    
    # Правила агрегации данных
    'aggregation_mode': 2,  # 1-3 варианта (используется для клиентов и менеджеров)
    # 1 - по client_id / все клиенты менеджера
    # 2 - по client_id + tb / только клиенты с тем же ТБ что и менеджер
    # 3 - по client_id + tb + gosb / только клиенты с тем же ТБ и ГОСБ что и менеджер
    
    # Настройки полей для поиска соответствий ТБ и ГОСБ
    'field_mapping': {
        'tb_fields': {
            'code_field': 'Код ТБ',      # Поле с кодом ТБ (по умолчанию)
            'short_name_field': 'ТБ',    # Поле с кратким названием ТБ
            'full_name_field': '',       # Поле с полным названием ТБ (пустое по умолчанию)
        },
        'gosb_fields': {
            'code_field': 'Код ГОСБ',    # Поле с кодом ГОСБ (по умолчанию)
            'short_name_field': 'ГОСБ',  # Поле с кратким названием ГОСБ
            'full_name_field': '',        # Поле с полным названием ГОСБ (пустое по умолчанию)
        }
    },
    
    # Настройки файлов
    'files': [
        {
            'path': str(IN_XLSX_DIR / 'QS ФОТ (30-06-2025).xlsx'),
            'sheet_name': 'Sheet1',
            'use_file': True,  # Использовать файл для анализа
            'columns': {
                'Таб. номер': 'tab_number',
                'КМ': 'fio',
                'ТБ': 'tb',
                'ГОСБ': 'gosb',
                'ИНН': 'client_id',
                'Клиент': 'client_name',
                'ФОТ': 'value'
            }
        },
        {
            'path': str(IN_XLSX_DIR / 'QS ФОТ (31-05-2025).xlsx'),
            'sheet_name': 'Sheet1',
            'use_file': True,  # Использовать файл для анализа
            'columns': {
                'Таб. номер': 'tab_number',
                'КМ': 'fio',
                'ТБ': 'tb',
                'ГОСБ': 'gosb',
                'ИНН': 'client_id',
                'Клиент': 'client_name',
                'ФОТ': 'value'
            }
        },
        {
            'path': str(IN_XLSX_DIR / 'QS ФОТ (30-04-2025).xlsx'),
            'sheet_name': 'Sheet1',
            'use_file': False,  # Не использовать файл для анализа (T-2 период)
            'columns': {
                'Таб. номер': 'tab_number',
                'КМ': 'fio',
                'ТБ': 'tb',
                'ГОСБ': 'gosb',
                'ИНН': 'client_id',
                'Клиент': 'client_name',
                'ФОТ': 'value'
            }
        }
    ],
    
    # Настройки выходного файла
    'output': {
        'file_name': str(OUT_XLSX_DIR / 'comparison_result'),
        'add_timestamp': True,  # Добавлять временную метку к имени файла
        'sheets': {
            'clients': 'Клиенты',
            'managers': 'Клиентские менеджеры',
            'managers_deal_date': 'КМ по дате сделки'
        },
        'columns': {
            'clients': [
                'ID client',
                'Client Name',
                'val (T-0)',
                'val (T-1)',
                'val (T-2)',
                'Gain',
                'TN (final)',
                'ФИО КМ (final)',
                'ГОСБ',
                'ТБ'
            ],
            'managers': [
                'TN (unic)',
                'ФИО',
                'ТБ',
                'ГОСБ',
                'val (T-0)',
                'val (T-1)',
                'val (T-2)',
                'Gain (total)'
            ],
            'managers_deal_date': [
                'TN (unic)',
                'ФИО',
                'ТБ',
                'ГОСБ',
                'val (T-0)',
                'val (T-1)',
                'val (T-2)',
                'Gain (total)'
            ]
        },
        # Форматирование колонок
        'formatting': {
            'clients': {
                'ID client': {'type': 'text_padded', 'format': '20', 'pad_char': '0'},
                'Client Name': {'type': 'text'},
                'val (T-0)': {'type': 'number', 'format': '#,##0.00'},
                'val (T-1)': {'type': 'number', 'format': '#,##0.00'},
                'val (T-2)': {'type': 'number', 'format': '#,##0.00'},
                'Gain': {'type': 'number', 'format': '#,##0.00'},
                'TN (final)': {'type': 'text_padded', 'format': '8', 'pad_char': '0'},
                'ФИО КМ (final)': {'type': 'text'},
                'ГОСБ': {'type': 'text'},
                'ТБ': {'type': 'text'}
            },
            'managers': {
                'TN (unic)': {'type': 'text_padded', 'format': '8', 'pad_char': '0'},
                'ФИО': {'type': 'text'},
                'ТБ': {'type': 'text'},
                'ГОСБ': {'type': 'text'},
                'val (T-0)': {'type': 'number', 'format': '#,##0.00'},
                'val (T-1)': {'type': 'number', 'format': '#,##0.00'},
                'val (T-2)': {'type': 'number', 'format': '#,##0.00'},
                'Gain (total)': {'type': 'number', 'format': '#,##0.00'}
            },
            'managers_deal_date': {
                'TN (unic)': {'type': 'text_padded', 'format': '8', 'pad_char': '0'},
                'ФИО': {'type': 'text'},
                'ТБ': {'type': 'text'},
                'ГОСБ': {'type': 'text'},
                'val (T-0)': {'type': 'number', 'format': '#,##0.00'},
                'val (T-1)': {'type': 'number', 'format': '#,##0.00'},
                'val (T-2)': {'type': 'number', 'format': '#,##0.00'},
                'Gain (total)': {'type': 'number', 'format': '#,##0.00'}
            },
            'clients_detail': {
                'ID клиента': {'type': 'text_padded', 'format': '20', 'pad_char': '0'},
                'Наименование клиента': {'type': 'text'},
                'Итоговый ТБ': {'type': 'text'},
                'Итоговый ГОСБ': {'type': 'text'},
                'Таб. номер (T-0)': {'type': 'text_padded', 'format': '8', 'pad_char': '0'},
                'ФИО КМ (T-0)': {'type': 'text'},
                'ТБ (T-0)': {'type': 'text'},
                'ГОСБ (T-0)': {'type': 'text'},
                'Показатель (T-0)': {'type': 'number', 'format': '#,##0.00'},
                'Таб. номер (T-1)': {'type': 'text_padded', 'format': '8', 'pad_char': '0'},
                'ФИО КМ (T-1)': {'type': 'text'},
                'ТБ (T-1)': {'type': 'text'},
                'ГОСБ (T-1)': {'type': 'text'},
                'Показатель (T-1)': {'type': 'number', 'format': '#,##0.00'},
                'Таб. номер (T-2)': {'type': 'text_padded', 'format': '8', 'pad_char': '0'},
                'ФИО КМ (T-2)': {'type': 'text'},
                'ТБ (T-2)': {'type': 'text'},
                'ГОСБ (T-2)': {'type': 'text'},
                'Показатель (T-2)': {'type': 'number', 'format': '#,##0.00'},
                'Итоговый таб. номер': {'type': 'text_padded', 'format': '8', 'pad_char': '0'},
                'Итоговое ФИО КМ': {'type': 'text'},
                'Итоговый прирост': {'type': 'number', 'format': '#,##0.00'}
            }
        }
    }
}

# Настройки для создания тестовых данных
TEST_DATA_CONFIG = {
    
    # Параметры клиентов
    'clients_count': 25000,  # Общее количество клиентов
    'clients_new_period_rate': 0.10,  # До 10% новых клиентов в следующем периоде
    'clients_leave_period_rate': 0.05,  # До 5% клиентов могут уйти в следующем периоде
    
    # Параметры менеджеров
    'managers_count_min': 1500,  # Минимальное количество менеджеров
    'managers_count_max': 1600,  # Максимальное количество менеджеров
    'managers_change_rate': 0.15,  # До 15% клиентов могут поменять менеджера
    'managers_tb_gosb_change_rate': 0.01,  # 1% менеджеров могут поменять ТБ/ГОСБ
    
    # Параметры ТБ и ГОСБ
    'tb_codes': [18, 42, 70, 38, 54, 55, 44, 40, 16, 99, 13, 52],  # Коды ТБ
    'managers_per_gosb_min': 5,  # Минимальное количество менеджеров в ГОСБ
    'managers_per_gosb_max': 18,  # Максимальное количество менеджеров в ГОСБ
    
    # Параметры дублей и серой зоны
    'duplicates_rate': 0.25,  # До 25% клиентов могут иметь дубли
    'duplicates_same_manager_rate': 0.05,  # До 5% дублей у того же менеджера
    'grey_zone_rate': 0.03,  # 3% клиентов за серой зоной без менеджера
    'grey_zone_tab_number': 'grey_zone',  # Табельный номер серой зоны
    'grey_zone_manager_name': 'Серая зона',  # Имя менеджера серой зоны
    
    # Параметры показателей
    'value_range': (10000, 1000000),  # Диапазон показателей
    'value_increase_rate': 0.80,  # 80% показателей увеличиваются
    'value_decrease_rate': 0.18,  # 18% показателей уменьшаются
    'value_no_change_rate': 0.02,  # 2% показателей не меняются
    'value_increase_range': (0.01, 0.15),  # Диапазон увеличения (1-15%)
    'value_decrease_range': (0.01, 0.05),  # Диапазон уменьшения (1-5%)
    
    # Названия тестовых файлов
    'test_files': [
        'test_data_period1.xlsx',
        'test_data_period2.xlsx', 
        'test_data_period3.xlsx'
    ],
    
    # Параметры генерации ФИО менеджеров
    'manager_names': {
        'first_names': [
            'Александр', 'Алексей', 'Андрей', 'Антон', 'Артем', 'Борис', 'Вадим', 'Валентин',
            'Валерий', 'Виктор', 'Владимир', 'Вячеслав', 'Геннадий', 'Георгий', 'Дмитрий',
            'Евгений', 'Игорь', 'Иван', 'Кирилл', 'Константин', 'Максим', 'Михаил', 'Николай',
            'Олег', 'Павел', 'Петр', 'Роман', 'Сергей', 'Станислав', 'Федор', 'Юрий'
        ],
        'last_names': [
            'Абрамов', 'Александров', 'Алексеев', 'Андреев', 'Антонов', 'Белов', 'Борисов',
            'Васильев', 'Волков', 'Григорьев', 'Дмитриев', 'Егоров', 'Жуков', 'Зайцев',
            'Иванов', 'Козлов', 'Кузнецов', 'Лебедев', 'Морозов', 'Николаев', 'Орлов',
            'Петров', 'Романов', 'Смирнов', 'Соколов', 'Степанов', 'Федоров', 'Чернов'
        ],
        'middle_names': [
            'Александрович', 'Алексеевич', 'Андреевич', 'Антонович', 'Артемович', 'Борисович',
            'Вадимович', 'Валентинович', 'Валериевич', 'Викторович', 'Владимирович', 'Вячеславович',
            'Геннадьевич', 'Георгиевич', 'Дмитриевич', 'Евгеньевич', 'Игоревич', 'Иванович',
            'Кириллович', 'Константинович', 'Максимович', 'Михайлович', 'Николаевич', 'Олегович',
            'Павлович', 'Петрович', 'Романович', 'Сергеевич', 'Станиславович', 'Федорович', 'Юрьевич'
        ]
    }
}

# Режимы работы программы
PROGRAM_MODES = {
    'mode': 4,  # 1-4 варианта работы
    
    # Варианты работы:
    # 1 - просто сгенерировать тест данные
    # 2 - посчитать на тест данных
    # 3 - посчитать на обычных данных
    # 4 - сгенерировать и посчитать на тест данных сразу
}

# Справочники кодов ТБ и ГОСБ
TB_GOSB_CODES = {
    'tb_codes': {
        18: {'full_name': 'Байкальский банк', 'short_name': 'ББ'},
        42: {'full_name': 'Волго-Вятский банк', 'short_name': 'ВВБ'},
        70: {'full_name': 'Дальневосточный банк', 'short_name': 'ДВБ'},
        38: {'full_name': 'Московский банк', 'short_name': 'МБ'},
        54: {'full_name': 'Поволжский банк', 'short_name': 'ПБ'},
        55: {'full_name': 'Северо-Западный банк', 'short_name': 'СЗБ'},
        44: {'full_name': 'Сибирский банк', 'short_name': 'СИБ'},
        40: {'full_name': 'Среднерусский банк', 'short_name': 'СРБ'},
        16: {'full_name': 'Уральский банк', 'short_name': 'УБ'},
        99: {'full_name': 'Центральный аппарат', 'short_name': 'ЦА'},
        13: {'full_name': 'Центрально-Черноземный банк', 'short_name': 'ЦЧБ'},
        52: {'full_name': 'Юго-Западный банк', 'short_name': 'ЮЗБ'}
    },
    'gosb_codes': {
        # Байкальский банк (18)
        (18, 1802): 'Аппарат Байкальского Банка',
        (18, 8586): 'Иркутское ГОСБ',
        (18, 8600): 'Читинское ГОСБ',
        (18, 8601): 'Бурятское ГОСБ',
        (18, 8603): 'Якутское ГОСБ',
        
        # Волго-Вятский банк (42)
        (42, 4200): 'Аппарат Волго-Вятского банка',
        (42, 6984): 'Пермское ГОСБ',
        (42, 8589): 'Мордовское ГОСБ',
        (42, 8610): 'Банк Татарстан ГОСБ',
        (42, 8611): 'Владимирское ГОСБ',
        (42, 8612): 'Кировское ГОСБ',
        (42, 8613): 'Чувашское ГОСБ',
        (42, 8614): 'Марий Эл ГОСБ',
        (42, 8618): 'Удмуртское ГОСБ',
        (42, 9042): 'ГО по Нижегородской области',
        
        # Дальневосточный банк (70)
        (70, 4157): 'Биробиджанское ГОСБ',
        (70, 7000): 'Аппарат Дальневосточного банка',
        (70, 8556): 'Камчатское ГОСБ',
        (70, 8557): 'Чукотское ГОСБ',
        (70, 8567): 'Южно-Сахалинское ГОСБ',
        (70, 8635): 'Приморское ГОСБ',
        (70, 8636): 'Благовещенское ГОСБ',
        (70, 8645): 'Северо-Восточное ГОСБ',
        (70, 9070): 'Хабаровское ГОСБ',
        
        # Московский банк (38)
        (38, 9038): 'Отделение Московского банка',
        (38, 90381): 'Управление МБ по работе с предприятиями инфраструктуры',
        (38, 90382): 'Управление МБ по работе с предприятиями промышленности',
        (38, 90383): 'Управление МБ по работе с предприятиями сферы недвижимости',
        (38, 90384): 'Управление МБ по работе с предприятиями сферы услуг',
        (38, 90385): 'Управление МБ по работе с предприятиями торговли',
        (38, 90386): 'Управление МБ по работе с предприятиями транспорта',
        
        # Поволжский банк (54)
        (54, 6991): 'Самарское ГОСБ',
        (54, 8588): 'Ульяновское ГОСБ',
        (54, 8621): 'Волгоградское ГОСБ',
        (54, 8622): 'Саратовское ГОСБ',
        (54, 8623): 'Оренбургское ГОСБ',
        (54, 8624): 'Пензенское ГОСБ',
        (54, 8625): 'Астраханское ГОСБ',
        (54, 9054): 'Аппарат Поволжского банка',
        
        # Северо-Западный банк (55)
        (55, 8617): 'Коми ГОСБ',
        (55, 8626): 'Калининградское ГОСБ',
        (55, 8627): 'Мурманское ГОСБ',
        (55, 8628): 'Карельское ГОСБ',
        (55, 8629): 'Новгородское ГОСБ',
        (55, 8630): 'Псковское ГОСБ',
        (55, 8637): 'Архангельское ГОСБ',
        (55, 8638): 'Вологодское ГОСБ',
        (55, 9055): 'Аппарат Северо-Западного банка',
        (55, 9500): 'ГО по Санкт-Петербургу',
        (55, 9600): 'ГО по Ленинградской области',
        
        # Сибирский банк (44)
        (44, 8047): 'Новосибирское ГОСБ',
        (44, 8558): 'Горно-Алтайское ГОСБ',
        (44, 8591): 'Кызылское ГОСБ',
        (44, 8602): 'Абаканское ГОСБ',
        (44, 8615): 'Кемеровское ГОСБ',
        (44, 8616): 'Томское ГОСБ',
        (44, 8634): 'Омское ГОСБ',
        (44, 8644): 'Алтайское ГОСБ',
        (44, 8646): 'Красноярское ГОСБ',
        (44, 9044): 'Аппарат Сибирского банка',
        
        # Среднерусский банк (40)
        (40, 17): 'Ярославское ГОСБ',
        (40, 1023): 'Восточное ГОСБ',
        (40, 1024): 'Южное ГОСБ',
        (40, 1025): 'Западное ГОСБ',
        (40, 1026): 'Северное ГОСБ',
        (40, 3000): 'Аппарат Среднерусского банка',
        (40, 8604): 'Тульское ГОСБ',
        (40, 8605): 'Брянское ГОСБ',
        (40, 8606): 'Рязанское ГОСБ',
        (40, 8607): 'Тверское ГОСБ',
        (40, 8608): 'Калужское ГОСБ',
        (40, 8609): 'Смоленское ГОСБ',
        (40, 8639): 'Ивановское ГОСБ',
        (40, 8640): 'Костромское ГОСБ',
        (40, 9040): 'Отделение Среднерусского банка',
        
        # Уральский банк (16)
        (16, 5940): 'Югорское отделение',
        (16, 7003): 'Свердловское ГОСБ',
        (16, 8369): 'Ямало-Ненецкое отделение',
        (16, 8597): 'Челябинское ГОСБ',
        (16, 8598): 'Башкирское ГОСБ',
        (16, 8599): 'Курганское ГОСБ',
        (16, 8647): 'Западно-Сибирское ГОСБ',
        (16, 9016): 'Аппарат Уральского банка',
        
        # Центрально-Черноземный банк (13)
        (13, 1300): 'Аппарат Центрально-Черноземного банка',
        (13, 8592): 'Белгородское ГОСБ',
        (13, 8593): 'Липецкое ГОСБ',
        (13, 8594): 'Тамбовское ГОСБ',
        (13, 8595): 'Орловское ГОСБ',
        (13, 8596): 'Курское ГОСБ',
        (13, 9013): 'ГО по Воронежской области',
        (13, 9014): 'ГО по Луганской Народной Республике',
        
        # Юго-Западный банк (52)
        (52, 1806): 'Центральное ГОСБ',
        (52, 5200): 'ГО по Республике Крым',
        (52, 5221): 'Ростовское ГОСБ',
        (52, 5230): 'Ставропольское ГОСБ',
        (52, 8579): 'Калмыцкое ОСБ',
        (52, 8585): 'Карачаево-Черкесское ОСБ',
        (52, 8590): 'Дагестанское ОСБ',
        (52, 8619): 'Краснодарское ГОСБ',
        (52, 8620): 'Адыгейское ГОСБ',
        (52, 8631): 'Кабардино-Балкарское ОСБ',
        (52, 8632): 'Северо-Осетинское ОСБ',
        (52, 8633): 'Ингушское ОСБ',
        (52, 8643): 'Чеченское ОСБ',
        (52, 9052): 'Аппарат Юго-Западного банка',
        (52, 9053): 'ГО по Донецкой Народной Республике'
    }
}

# Настройки для генерации названий клиентов
CLIENT_NAMES_CONFIG = {
    # Базовые названия компаний
    'company_names': [
        'ООО Ромашка', 'ООО Василек', 'ООО Тюльпан', 'ООО Роза', 'ООО Лилия',
        'ООО Орхидея', 'ООО Пион', 'ООО Гвоздика', 'ООО Хризантема', 'ООО Астра',
        'ООО Георгин', 'ООО Нарцисс', 'ООО Ирис', 'ООО Фиалка', 'ООО Маргаритка',
        'ООО Подсолнух', 'ООО Мак', 'ООО Клевер', 'ООО Лютик', 'ООО Незабудка',
        'ООО Колокольчик', 'ООО Анютины глазки', 'ООО Бархатцы', 'ООО Петуния',
        'ООО Бегония', 'ООО Фуксия', 'ООО Герань', 'ООО Пеларгония', 'ООО Бальзамин',
        'ООО Импатиенс', 'ООО Вербена', 'ООО Лобелия', 'ООО Агератум', 'ООО Цинния',
        'ООО Космея', 'ООО Эшшольция', 'ООО Кларкия', 'ООО Годеция', 'ООО Левкой',
        'ООО Маттиола', 'ООО Душистый горошек', 'ООО Настурция', 'ООО Ипомея',
        'ООО Вьюнок', 'ООО Кобея', 'ООО Долихос', 'ООО Фасоль декоративная',
        'ООО Лаватера', 'ООО Мальва', 'ООО Шток-роза', 'ООО Холлихок'
    ],
    
    # Префиксы для уникальности
    'prefixes': [
        'Главный', 'Первый', 'Второй', 'Третий', 'Четвертый', 'Пятый',
        'Центральный', 'Северный', 'Южный', 'Восточный', 'Западный',
        'Красногорский', 'Подольский', 'Мытищинский', 'Химкинский',
        'Балашихинский', 'Люберецкий', 'Одинцовский', 'Раменский',
        'Серпуховский', 'Коломенский', 'Домодедовский', 'Ступинский',
        'Чеховский', 'Сергиево-Посадский', 'Пушкинский', 'Истринский',
        'Наро-Фоминский', 'Волоколамский', 'Лотошинский', 'Шаховской',
        'Можайский', 'Рузский', 'Озерский', 'Зарайский', 'Луховицкий',
        'Серебряно-Прудский', 'Каширский', 'Зарайский', 'Ступинский'
    ],
    
    # Суффиксы для уникальности
    'suffixes': [
        'Филиал', 'Представительство', 'Дочерняя компания', 'Подразделение',
        'Отделение', 'Офис', 'Центр', 'База', 'Склад', 'Терминал',
        'Логистический центр', 'Торговый дом', 'Группа компаний',
        'Холдинг', 'Концерн', 'Корпорация', 'Ассоциация', 'Союз'
    ]
}
